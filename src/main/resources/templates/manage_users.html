<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Система управления пользователями</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        /* Фоновое изображение */
        body {
            background-image: url('https://plus.unsplash.com/premium_photo-1661663603858-2df08fe3d65d?q=80&w=3540&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
            background-size: cover; /* Растягиваем фон на весь экран */
            background-position: center; /* Центрируем фон */
            background-repeat: no-repeat; /* Убираем повторение фона */
            height: 100vh; /* Занимаем всю высоту экрана */
            color: white; /* Белый текст для контраста */
        }

        /* Стилизация контейнера */
        .container {
            background-color: rgba(0, 0, 0, 0.6); /* Полупрозрачный черный фон */
            padding: 20px;
            border-radius: 10px;
            margin-top: 2%;
            margin-bottom: 2%;
        }

        /* Стилизация кнопок */
        .btn-custom-primary {
            background-color: #F5DEB3;
            border-color: #F5DEB3;
            color: black; /* Черный текст для контраста */
            transition: background-color 0.3s ease;
        }

        .btn-custom-primary:hover {
            background-color: #e0c79b; /* Темнее при наведении */
            border-color: #e0c79b;
        }

        .btn-custom-secondary {
            background-color: #D2B48C;
            border-color: #D2B48C;
            color: black; /* Черный текст для контраста */
            transition: background-color 0.3s ease;
        }

        .btn-custom-secondary:hover {
            background-color: #b89a7a; /* Темнее при наведении */
            border-color: #b89a7a;
        }

        .btn-logout {
            background-color: #ff4d4d; /* Красный цвет для кнопки выхода */
            border-color: #ff4d4d;
            color: white;
            transition: background-color 0.3s ease;
        }

        .btn-logout:hover {
            background-color: #cc0000; /* Темнее при наведении */
            border-color: #cc0000;
        }

        .btn-admin {
            background-color: #4CAF50; /* Зеленый цвет для кнопки администратора */
            border-color: #4CAF50;
            color: white;
            transition: background-color 0.3s ease;
        }

        .btn-admin:hover {
            background-color: #45a049; /* Темнее при наведении */
            border-color: #45a049;
        }

        /* Стилизация таблицы */
        .table {
            color: white; /* Белый текст в таблице */
        }

        .table-hover tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.1); /* Полупрозрачный белый фон при наведении */
        }

        .current-user {
            background-color: #F0E68C; /* Светло-желтый фон для выделения текущего пользователя */
            color: black; /* Черный текст для контраста */
            font-weight: bold; /* Жирный шрифт */
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Кнопка "Назад" -->
    <a th:href="@{/}">
        <button type="button" class="btn btn-custom-primary">Назад</button>
    </a>

    <!-- Заголовок -->
    <blockquote class="blockquote text-center">
        <h1>Система управления пользователями</h1>
    </blockquote>

    <!-- Кнопка для открытия модального окна -->
    <button type="button" class="btn btn-custom-secondary" data-bs-toggle="modal" data-bs-target="#addUserModal">
        Добавить пользователя
    </button>

    <!-- Модальное окно -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Добавить нового пользователя</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/users/new}" method="post">
                        <div class="mb-3">
                            <label for="username" class="form-label">Имя пользователя</label>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Пароль</label>
                            <input type="password" class="form-control" id="password" name="password" required>
                        </div>
                        <div class="mb-3">
                            <label for="role" class="form-label">Роль</label>
                            <select class="form-select" id="role" name="role" required>
                                <option value="USER">USER</option>
                                <option value="ADMIN">ADMIN</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                            <button type="submit" class="btn btn-primary">Сохранить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Таблица пользователей -->
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th scope="col">ID пользователя</th>
            <th scope="col">Имя пользователя</th>
            <th scope="col">Пароль пользователя</th>
            <th scope="col">Роль пользователя</th>
            <th scope="col">Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="user: ${listSUsers}" th:class="${user.username == currentUsername} ? 'current-user' : ''">
            <th scope="row" th:text="${user.id}">ID пользователя отсутствует</th>
            <th scope="row" th:text="${user.username}">Имя пользователя отсутствует</th>
            <th scope="row" th:text="${user.password}">Пароль пользователя отсутствует</th>
            <th scope="row" th:text="${user.role}">Роль пользователя отсутствует</th>
            <th scope="row">
                <!-- Если пользователь не является текущим, показываем выпадающий список и кнопку -->
                <div th:unless="${user.username == currentUsername}">
                    <form th:action="@{/users/updateRole}" method="post">
                        <input type="hidden" name="id" th:value="${user.id}">
                        <select name="role" class="form-select" style="width: auto;">
                            <option th:value="USER" th:selected="${user.role == 'USER'}">USER</option>
                            <option th:value="ADMIN" th:selected="${user.role == 'ADMIN'}">ADMIN</option>
                        </select>
                        <button type="submit" class="btn btn-success btn-sm mt-2">Сохранить</button>
                    </form>
                </div>
            </th>
            <td>
                <a th:unless="${user.role == 'ADMIN'}" th:href="@{'/users/delete/' +${user.id}}">
                    <button type="button" class="btn btn-danger">Удалить</button>
                </a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Подключение Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>
</html>